<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Test - AutoSherpa</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .image-test { margin: 20px 0; padding: 20px; border: 1px solid #ccc; }
        .image-container { margin: 10px 0; }
        img { max-width: 300px; max-height: 200px; border: 1px solid #ddd; }
        .error { color: red; }
        .success { color: green; }
        .info { color: blue; }
    </style>
</head>
<body>
    <h1>üîç Image Loading Test</h1>
    
    <div class="image-test">
        <h2>Test Local Images</h2>
        <div id="localImages">
            <p>Loading local images...</p>
        </div>
    </div>
    
    <div class="image-test">
        <h2>Test Cloudinary Images</h2>
        <div id="cloudinaryImages">
            <p>Loading Cloudinary images...</p>
        </div>
    </div>
    
    <div class="image-test">
        <h2>Database Image Paths</h2>
        <div id="databaseImages">
            <p>Loading database images...</p>
        </div>
    </div>

    <script>
        // Test local image loading
        async function testLocalImages() {
            const container = document.getElementById('localImages');
            container.innerHTML = '<p>Testing local image loading...</p>';
            
            // Test a sample local path
            const testPaths = [
                'uploads/cars/MH61AB0030/MH61AB0030_1.jpg',
                'uploads/cars/MH61AB0030/MH61AB0030_2.jpg'
            ];
            
            let results = '';
            for (const imagePath of testPaths) {
                try {
                    const img = new Image();
                    img.onload = () => {
                        results += `<div class="image-container success">‚úÖ ${imagePath} - Loaded successfully</div>`;
                        container.innerHTML = results;
                    };
                    img.onerror = () => {
                        results += `<div class="image-container error">‚ùå ${imagePath} - Failed to load</div>`;
                        container.innerHTML = results;
                    };
                    img.src = `/${imagePath}`;
                } catch (error) {
                    results += `<div class="image-container error">‚ùå ${imagePath} - Error: ${error.message}</div>`;
                    container.innerHTML = results;
                }
            }
        }
        
        // Test Cloudinary images
        async function testCloudinaryImages() {
            const container = document.getElementById('cloudinaryImages');
            container.innerHTML = '<p>Testing Cloudinary image loading...</p>';
            
            // Test Cloudinary URLs (if any exist)
            const testUrls = [
                'https://res.cloudinary.com/dwj8oatac/image/upload/v1/autosherpa/cars/sample.jpg'
            ];
            
            let results = '';
            for (const imageUrl of testUrls) {
                try {
                    const img = new Image();
                    img.onload = () => {
                        results += `<div class="image-container success">‚úÖ ${imageUrl} - Loaded successfully</div>`;
                        container.innerHTML = results;
                    };
                    img.onerror = () => {
                        results += `<div class="image-container error">‚ùå ${imageUrl} - Failed to load</div>`;
                        container.innerHTML = results;
                    };
                    img.src = imageUrl;
                } catch (error) {
                    results += `<div class="image-container error">‚ùå ${imageUrl} - Error: ${error.message}</div>`;
                    container.innerHTML = results;
                }
            }
        }
        
        // Load database images
        async function loadDatabaseImages() {
            const container = document.getElementById('databaseImages');
            container.innerHTML = '<p>Loading database images...</p>';
            
            try {
                // Get auth token from localStorage
                const token = localStorage.getItem('authToken');
                if (!token) {
                    container.innerHTML = '<p class="error">‚ùå Not logged in. Please log in first.</p>';
                    return;
                }
                
                const response = await fetch('/api/cars', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (response.ok) {
                    const cars = await response.json();
                    let results = `<p class="info">üìä Found ${cars.length} cars in database</p>`;
                    
                    for (const car of cars) {
                        if (car.image_paths && car.image_paths.length > 0) {
                            results += `<div class="image-container">`;
                            results += `<h4>üöó ${car.registration_number} (${car.brand} ${car.model})</h4>`;
                            results += `<p>Images: ${car.image_paths.length}</p>`;
                            
                            for (let i = 0; i < car.image_paths.length; i++) {
                                const imagePath = car.image_paths[i];
                                const imageType = car.image_types[i];
                                
                                if (imagePath) {
                                    results += `<div style="margin: 10px 0;">`;
                                    results += `<p><strong>${imageType}:</strong> ${imagePath}</p>`;
                                    
                                    if (imagePath.startsWith('http')) {
                                        // Cloudinary URL
                                        results += `<img src="${imagePath}" alt="${imageType}" onerror="this.style.display='none'">`;
                                    } else {
                                        // Local path
                                        results += `<img src="/${imagePath}" alt="${imageType}" onerror="this.style.display='none'">`;
                                    }
                                    results += `</div>`;
                                }
                            }
                            results += `</div>`;
                        }
                    }
                    
                    container.innerHTML = results;
                } else {
                    container.innerHTML = '<p class="error">‚ùå Failed to load cars data</p>';
                }
                
            } catch (error) {
                container.innerHTML = `<p class="error">‚ùå Error: ${error.message}</p>`;
            }
        }
        
        // Run tests when page loads
        document.addEventListener('DOMContentLoaded', function() {
            testLocalImages();
            testCloudinaryImages();
            loadDatabaseImages();
        });
    </script>
</body>
</html>
